let{href:h}=window.location;var n=h.indexOf("pgy.xiaohongshu.com")>-1,e=XMLHttpRequest.prototype,l=e.open,d=e.setRequestHeader,r=!1;function i(t){r||(r=!0,console.log("rewriteSend",t),e.send=function(s){return this.addEventListener("load",function(){var o=this._url?this._url.toLowerCase():this._url;if(o){var a=this.getAllResponseHeaders();if(["","text"].includes(this.responseType)&&this.responseText)try{window.postMessage({ajax_rewrite:JSON.stringify({url:this._url,postData:s,requestHeaders:this._requestHeaders,responseHeaders:a,responseText:this.responseText})},"*")}catch(u){console.log(u,"Error in responseType try catch")}}}),t.apply(this,arguments)})}n||i(e.send);e.open=function(t,s){return this._method=t,this._url=s,this._requestHeaders={},this._startTime=new Date().toISOString(),n&&i(e.send),l.apply(this,arguments)};e.setRequestHeader=function(t,s){return this._requestHeaders[t]=s,d.apply(this,arguments)};console.log("ajax-rewrite done");
