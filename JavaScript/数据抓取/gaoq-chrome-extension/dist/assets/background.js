var d="RELOAD";chrome.runtime.onMessage.addListener((e,u,o)=>{e.msg==d&&(chrome.runtime.reload(),o())});function b(e,u){return e._from="gaoqu extension "+u,e}const g={page\u901A\u8FC7content\u53D1\u9001\u7ED9background:"page\u901A\u8FC7content\u53D1\u9001\u7ED9background",background\u901A\u8FC7content\u53D1\u9001\u7ED9page:"background\u901A\u8FC7content\u53D1\u9001\u7ED9page",content\u901A\u8FC7background\u8F6C\u53D1\u5176\u4ED6content\u53D1\u9001\u7ED9page:"content\u901A\u8FC7background\u8F6C\u53D1\u5176\u4ED6content\u53D1\u9001\u7ED9page",content\u53D1\u9001\u7ED9background:"content\u53D1\u9001\u7ED9background",background\u53D1\u9001\u7ED9content:"background\u53D1\u9001\u7ED9content"},r={\u83B7\u53D6\u5F53\u524DtabId:"\u83B7\u53D6\u5F53\u524DtabId",\u901A\u77E5\u5DF2\u8865\u4E01:"\u901A\u77E5\u5DF2\u8865\u4E01",\u901A\u77E5\u5DF2\u63D0\u53D6:"\u901A\u77E5\u5DF2\u63D0\u53D6",\u8BBE\u7F6E\u63D2\u4EF6\u8BA4\u8BC1\u7801:"\u8BBE\u7F6E\u63D2\u4EF6\u8BA4\u8BC1\u7801",\u6E05\u9664\u63D2\u4EF6\u8BA4\u8BC1\u7801:"\u6E05\u9664\u63D2\u4EF6\u8BA4\u8BC1\u7801",\u5173\u95ED\u5F53\u524D\u5E76\u8DF3\u8F6Ctab:"\u5173\u95ED\u5F53\u524D\u5E76\u8DF3\u8F6Ctab",\u7CFB\u7EDF\u901A\u77E5:"\u7CFB\u7EDF\u901A\u77E5",\u901A\u77E5\u5DF2\u5165\u5E93:"\u901A\u77E5\u5DF2\u5165\u5E93",\u6E05\u7406\u7F13\u5B58:"\u6E05\u7406\u7F13\u5B58",TTS:"TTS",Cookie:"Cookie",SetCookies:"SetCookies"},l="background",F={mode:"pac_script",pacScript:{url:"http://101.34.133.164/cxprod/static/proxy.pac"}};chrome.proxy.settings.set({value:F,scope:"regular"},function(){console.log("proxy load"),chrome.proxy.settings.get({incognito:!1},function(e){console.log(e)})});chrome.runtime.onMessage.addListener(async function(e,u,o){let{msg:s,aim:n}=e;if(g.page\u901A\u8FC7content\u53D1\u9001\u7ED9background===s){if(r.\u83B7\u53D6\u5F53\u524DtabId==n)o(b({msg:g.background\u901A\u8FC7content\u53D1\u9001\u7ED9page,aim:n,tabId:u.tab?u.tab.id:"\u83B7\u53D6\u4E0D\u5230"},l));else if(r.\u8BBE\u7F6E\u63D2\u4EF6\u8BA4\u8BC1\u7801==n){let{user:t,extra:c}=e;if(o(b({msg:g.background\u901A\u8FC7content\u53D1\u9001\u7ED9page,aim:n,user:t},l)),await chrome.storage.local.set({user:t}),console.log("chrome.storage.local.set extensionToken",t,c),c){let{isExtensionSignIn:a,fromTabId:i}=c;a&&i&&(i=+i,chrome.tabs.update(i,{active:!0}),chrome.tabs.sendMessage(i,{msg:g.background\u53D1\u9001\u7ED9content,aim:n,user:t}),u.tab&&u.tab.id&&chrome.tabs.remove(u.tab.id))}}else if(r.\u6E05\u9664\u63D2\u4EF6\u8BA4\u8BC1\u7801===n)await chrome.storage.local.remove("user"),o(b({msg:g.background\u901A\u8FC7content\u53D1\u9001\u7ED9page,aim:n},l));else if(r.\u5173\u95ED\u5F53\u524D\u5E76\u8DF3\u8F6Ctab===n){let{tabId:t}=e;t=+t,chrome.tabs.update(t,{active:!0}),u.tab&&u.tab.id&&chrome.tabs.remove(u.tab.id)}else if(r.SetCookies===n){let{cookies:t}=e;console.log("SetCookies",e),o("background receive Aim.SetCookies ok");let c=await Promise.all(t.map(a=>chrome.cookies.set(a)));if(u.tab){let a=u.tab.id;console.log("cookieList",c),chrome.tabs.sendMessage(a,{msg:g.background\u901A\u8FC7content\u53D1\u9001\u7ED9page,aim:n,cookieList:c})}}}else if(g.content\u901A\u8FC7background\u8F6C\u53D1\u5176\u4ED6content\u53D1\u9001\u7ED9page===s){let{toTabId:t,closeTab:c,closeTabIds:a}=e;t&&(c&&chrome.tabs.update(t,{active:!0}),chrome.tabs.sendMessage(t,e,o)),c&&u.tab&&u.tab.id&&chrome.tabs.remove(u.tab.id),a&&a.forEach(function(i){chrome.tabs.remove(i)})}else if(g.content\u53D1\u9001\u7ED9background===s)if(r.\u7CFB\u7EDF\u901A\u77E5===n){let{title:t,message:c}=e;chrome.tts.speak(c),chrome.notifications.create({type:"basic",title:t,message:c,iconUrl:"icons/logo.png"})}else if(r.\u6E05\u7406\u7F13\u5B58===n){let{options:t,dataSet:c,title:a,message:i}=e;chrome.browsingData.remove(t,c,function(){console.log("\u6E05\u7406\u7F13\u5B58 done",t,c),chrome.tts.speak(i),chrome.notifications.create({type:"basic",title:a,message:i,iconUrl:"icons/logo.png"})})}else if(r.TTS===n){let{message:t}=e;chrome.tts.speak(t)}else if(r.Cookie===n){let{domain:t}=e;o("background receive Aim.Cookie ok");let c=await chrome.cookies.getAll({domain:t});if(u.tab){let a=u.tab.id;e.cookies=c,chrome.tabs.sendMessage(a,e)}}else r.\u83B7\u53D6\u5F53\u524DtabId===n&&o(u.tab?u.tab.id:"")});const f=chrome.runtime.getManifest();console.log("manifest",f);const D=[];var E;(E=f.content_scripts)==null||E.forEach(function({js:e,matches:u}){(e==null?void 0:e.length)&&e[0]!=="content-dev.js"&&(u==null||u.forEach(function(o){let s=o.indexOf("?");s>-1&&(o=o.substring(0,s)),D.push(o.replace("*",""))}))});console.log("activeList",D);function m(e){if(e){for(let u=0;u<D.length;u++)if(e.indexOf(D[u])>-1)return!0}return!1}chrome.tabs.onActivated.addListener(async function(e){let{tabId:u}=e,o=await chrome.tabs.get(u);m(o.url)?(chrome.action.setBadgeTextColor({color:"#fff"}),chrome.action.setBadgeBackgroundColor({color:"green"}),chrome.action.setBadgeText({text:"ON"})):(chrome.action.setBadgeTextColor({color:"#fff"}),chrome.action.setBadgeBackgroundColor({color:"red"}),chrome.action.setBadgeText({text:"OFF"})),console.log(l,"onActivated",u,o.url)});
