var v=Object.defineProperty;var x=(i,e,t)=>e in i?v(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var m=(i,e,t)=>(x(i,typeof e!="symbol"?e+"":e,t),t);import{_,R as y,p as P,b as S,r as b,o as h,c as T,a as j,d as E,F as $,j as L,e as k,f as C,A as F,h as R,i as O,g as B,t as D,k as A,T as q,S as H,V as M}from"./jss-preset-default.esm.js";function g(i){const e=document.querySelector("#crx-app");let t=i.clientX-e.offsetLeft,s=i.clientY-e.offsetTop;function o(c){let n=c.clientX-t,l=c.clientY-s;e.style.left=n+"px",e.style.top=l+"px"}function r(c){document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",r)}document.addEventListener("mousemove",o),document.addEventListener("mouseup",r)}function W(i){let e=1;window.addEventListener("load",function(){e<2&&(clearTimeout(t),console.log("init from load count",e),e++,i())});let t=setTimeout(function(){console.log("init from setTimout count",e),e++,i()},2e3)}const G=chrome.runtime.getURL("./assets/icons/logo.png"),U={components:{RenderComponent:y},data(){return{publication:P,src:G,renderFunctionMap:{}}},created(){S(this)},mounted(){document.querySelector("#crx-app").addEventListener("mousedown",g)},unmounted(){document.querySelector("#crx-app").removeEventListener("mousedown",g),this.it&&clearTimeout(this.it)}};function X(i,e,t,s,o,r){const c=b("RenderComponent");return h(!0),T($,null,j(o.renderFunctionMap,(n,l)=>(h(),E(c,{key:l,renderFunction:n},null,8,["renderFunction"]))),128)}const Y=_(U,[["render",X],["__file","/Library/PP/GaoQ/pnpm-vite-vue3/gaoq-chrome-extension/src/content-scripts/Common.vue"]]),a=[],u=[],p=[];class I{constructor(){m(this,"whiteList",[])}setWhiteList(e){console.log("setWhiteList",e),this.whiteList=e}publish(e){const t=JSON.parse(e);let s=!0;if(this.whiteList.length>1){s=!1;for(var o=0;o<this.whiteList.length;o++){let r=this.whiteList[o];if(t.url.indexOf(r)>-1){s=!0;break}}}s&&(a.push(t),this.digest(t))}digest(e){for(let t=u.length-1,s=0;t>=s;t--){let{regex:o,controlList:r}=u[t];if(e.url.match(o)){console.debug("digest subscribe match",e,r);for(let n of r)if(n.status=="todo"){let l=n.filter(e);console.log("hit",l),l&&(n.resolve(l),n.status="resolved",clearTimeout(n.it))}else console.debug("digest after timeout",n);u.splice(t,1)}}for(let t of p){let{regex:s,controlList:o}=t;if(e.url.match(s)){console.debug("digest watch match",e,o);for(let{cb:c,filter:n}of o){let l=n(e);l&&c(l)}}}}watch(e,t,s){if(!t)throw"bus.watch filter\u5FC5\u586B";let o=this.getPortData(e,t);o&&s(o);let r={cb:s,filter:t};const c=p.find(n=>n.regex.toString()==e.toString());console.log("find",c),c?c.controlList.push(r):p.push({regex:e,controlList:[r]})}subscribe(e,t,s=5e3){if(!t)throw"bus.subscribe filter\u5FC5\u586B";return new Promise((o,r)=>{let c=this.getPortData(e,t);if(c)o(c);else{let n={resolve:o,status:"todo",filter:t,it:-1};const l=u.find(w=>w.regex.toString()==e.toString());l?l.controlList.push(n):u.push({regex:e,controlList:[n]}),n.it=setTimeout(function(){n.status==="todo"&&(console.log("subscribe failed",e,"\u8BF7\u786E\u4FDD\u52A0\u5165\u767D\u540D\u5355"),r(),n.status="rejected")},s)}})}parseBody(e){if(!e.body&&typeof e.responseText=="string"&&e.responseText[0]==="{")try{e.body=JSON.parse(e.responseText),delete e.responseText}catch(t){console.debug(t,e.responseText)}return e.body}parseHeader(e){if(!e.headers&&typeof e.responseHeaders=="string"){const t={};e.responseHeaders.split(`\r
`).forEach(o=>{if(o){let[r,c]=o.split(/\s*:\s*/);t[r]=c}}),e.headers=t}return e.headers}getPortData(e,t){for(let s=a.length-1;s>=0;s--){let o=a[s];if(e.test(o.url)){let r=t(o);if(r)return r}}return null}getTodoList(){return a}getSubscribeList(){return u}getWatchList(){return p}}console.log("\u7B2C\u51E0\u4EFDbus");const f=new I;let{href:d}=window.location,J=d.indexOf("op.gaoq.com")>-1||d.indexOf("localhost:8088")>-1;if(J)console.log("isOp");else{if(!(d.indexOf("buyin.jinritemai")>-1||d.indexOf("www.douyin.com")>-1)){const e=document.createElement("script");e.id="ajaxRewrite",e.src=chrome.runtime.getURL("content-scripts/injected/ajax-rewrite.js"),e.onload=function(){e.remove()},console.log("src",e.src),(document.head||document.documentElement).appendChild(e)}window.addEventListener("message",function(e){if(e.data.ajax_rewrite){let t=e.data.ajax_rewrite;f.publish(t)}},!1),chrome.storage.local.get("whiteList").then(e=>{e&&e.hasOwnProperty("whiteList")&&(console.table([{name:"chrome.storage.local.get",msg:"ok",length:e.whiteList.length}]),f.setWhiteList(e.whiteList))})}L.setup(k());W(function(){const i=document.querySelector("body");if(i){i.insertAdjacentHTML("afterend",'<div id="crx-app" class="animate__lightSpeedInRight"></div>');const e=C(Y);e.config.globalProperties.$ajax=F,e.config.globalProperties.$bus=f,e.config.globalProperties.$resolveComponent=b,e.config.globalProperties.$h=R,e.config.globalProperties.$computed=O,e.config.globalProperties.$ref=B,e.config.globalProperties.$toRaw=D,e.config.globalProperties.$reactive=A,e.config.globalProperties.$Teleport=q,e.config.globalProperties.$Suspense=H,e.config.globalProperties.$jss=L,e.use(M).mount("#crx-app")}});
